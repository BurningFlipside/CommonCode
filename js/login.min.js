function login_submit_done(o){if(200!==o.status){var t=1*getParameterByName("failed"),i=window.location;t++,window.location=window.loginUrl+"?failed="+t+"&return="+i}else if(void 0!==o.responseJSON){var n=o.responseJSON,r="";n.return?r=n.return:null===(r=getParameterByName("return"))&&(r=window.location),n.extended&&console.log(n.extended),window.location=r}}function login_submitted(o){o.preventDefault();var t=$("body").data("login-url");if(void 0===t){var i=$("script[src*=login]").attr("src"),n=i.split("/").pop();n=(i=i.replace("/"+n,"")).split("/").pop(),t=(i=i.replace("/"+n,""))+"/api/v1/login"}var r=o.target.form;return $.ajax({url:t,data:$(r).serialize(),type:"post",dataType:"json",complete:login_submit_done}),!1}function login_dialog_shown(){$("[name=username]").focus()}function do_login_init(){var o=$("ul a[href*=login]");void 0!==window.browser_supports_cors&&browser_supports_cors()?(o.attr("data-toggle","modal"),o.attr("data-target","#login-dialog"),o.removeAttr("href"),o.css("cursor","pointer"),(o=$("#content a[href*='login']")).attr("data-toggle","modal"),o.attr("data-target","#login-dialog"),o.removeAttr("href"),o.css("cursor","pointer")):o.attr("href",o.attr("href")+"?return="+document.URL),$("#login_main_form").length>0&&$("#login_main_form :submit").on("click",login_submitted),$("#login_dialog_form").length>0&&$("#login_dialog_form :submit").on("click",login_submitted),$("#login-dialog").length>0&&($("#login-dialog").modal({show:!1,backdrop:"static"}),$("#login-dialog").on("shown.bs.modal",login_dialog_shown))}$(do_login_init);
